<html>
    <head>
        <title>
            Drawer
        </title>
    </head>
    <body>
        <p id='text1'>Here will be the drawer coordinates</p>
        <p id='text2'>Here will be the drawer mouse reaction</p>
        <canvas height="300" width="600" id="canvas", style="background-color:'white'; border: 1px solid #000;"></canvas>
        <p>
            Instrument: 
            <select size="1" id="type">
                <option selected value="rays">rays</option>
                <option value="pencil">pencil</option>
            </select>
        </p>
        <p>
            Width: 
            <select size="1" id="width">
                <option selected value=1>1</option>
                <option value=2>2</option>
                <option value=3>3</option>
                <option value=4>4</option>
                <option value=5>5</option>
                <option value=8>8</option>
                <option value=10>10</option>
            </select>
        </p>
        <p>
            Color: 
            <select size="1" id="color">
                <option selected value="255, 0, 0">red</option>
                <option value="255, 0, 255">pink</option>
                <option value="0, 0, 255">blue</option>
                <option value="0, 255, 255">cyan</option>
                <option value="0, 255, 0">green</option>
                <option value="255, 255, 0">yellow</option>
            </select>
        </p>
        <p>
            Transparancy: 
            <select size="1" id="alpha">
                <option selected value="0.2">0.2</option>
                <option value="0.4">0.4</option>
                <option value="0.6">0.6</option>
                <option value="0.8">0.8</option>
                <option value="1.0">1.0</option>
            </select>
        </p>
        <script>

            // draw coordinate grid //

            let canv = document.getElementById("canvas");
            ctx = canv.getContext('2d');
            
            for (let x = 0.5; x < canv.width; x += 10) {
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canv.height);
            }
            for (let y = 0.5; y < canv.height; y += 10) {
                ctx.moveTo(0, y);
                ctx.lineTo(canv.width, y);
            }
            ctx.strokeStyle = '#eee';
            ctx.stroke();
            let box = canv.getBoundingClientRect();
            let pointX, pointY
            let typeOption = document.getElementById("type").options.selectedIndex;

            // handle selects //

            function changeParams() {
                
            }


            // functions //

            function showCoords (e, typeOption) {
                typeOption = document.getElementById("type").options.selectedIndex;
                if (typeOption !== 6) {
                    let canvas_x = e.clientX - box.left;
                    let canvas_y = e.clientY - box.top;
                    t = document.getElementById("text1");
                    t.innerHTML = `Coordinates: ${canvas_x}, ${canvas_y}`;
                }
            }

            function getParams() {
                let colorOption = document.getElementById("color").options.selectedIndex;
                let colorVal = document.getElementById("color").options[colorOption].value;
                let alphaOption = document.getElementById("alpha").options.selectedIndex;
                let alphaVal = document.getElementById("alpha").options[alphaOption].value;
                let colorCombined = `rgba(${colorVal}, ${alphaVal})`;
                let widthOption = document.getElementById("width").options.selectedIndex;
                let widthVal = document.getElementById("width").options[widthOption].value;
                console.log('in func', colorCombined)
                return colorCombined, widthVal;
            }

            function drawRays(e) {
                let canvasX = e.clientX - box.left;
                let canvasY = e.clientY - box.top;
                let colorCombined, widthVal
                colorCombined, widthVal = getParams()
                console.log('out', colorCombined)
                ctx.beginPath();
                ctx.moveTo(canvasX, canvasY);
                ctx.lineTo(pointX, pointY);
                ctx.lineWidth = widthVal;
                ctx.strokeStyle = colorCombined;
                ctx.stroke();
            }

            function drawFree(e) {
                // let nowX = e.clientX - box.left, nowY = e.clientY - box.top;
                // let oldX = e.clientX - box.left, oldY = e.clientY - box.top;

                nowX = e.clientX - box.left;
                nowY = e.clientY - box.top;
                if (nowX === oldX && nowY === oldY) return;

                ctx.beginPath();
                ctx.moveTo(nowX, nowY);
                ctx.lineTo(oldX, oldY);
                let colorOption = document.getElementById("color").options.selectedIndex;
                let colorVal = document.getElementById("color").options[colorOption].value;
                let widthOption = document.getElementById("width").options.selectedIndex;
                let widthVal = document.getElementById("width").options[widthOption].value;
                ctx.lineWidth = widthVal;
                ctx.strokeStyle = colorVal;
                ctx.stroke();
                oldX = nowX, oldY = nowY;
            }

            // event handlers //

            canvas.addEventListener('mousemove', showCoords);

            canvas.onmousedown = function (e) {
                oldX = e.clientX - box.left;
                oldY = e.clientY- box.top;

                t2 = document.getElementById("text2");
                t2.innerHTML = 'Mouse is pressed';
                typeOption = document.getElementById("type").options.selectedIndex;
                if (typeOption == 0) {
                    canvas.addEventListener('mousemove', drawRays);
                } else {
                    canvas.addEventListener('mousemove', drawFree);
                }
            }

            canvas.onmouseup = function () {
                t2 = document.getElementById("text2");
                t2.innerHTML = 'Mouse is released';
                typeOption = document.getElementById("type").options.selectedIndex;
                if (typeOption == 0) {
                    canvas.removeEventListener('mousemove', drawRays);
                } else {
                    canvas.removeEventListener('mousemove', drawFree);
                }
            }

            canvas.onclick = function (e) {
                pointX = e.clientX - box.left;
                pointY = e.clientY- box.top;
            }
        </script>
    </body>
</html>